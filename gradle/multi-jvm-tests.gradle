// Ideally every LTS release plus the latest released Java version.
def additionalTestRunsOnJvmVersions = 
    System.getenv("ADDITIONAL_TEST_RUNS_ON_JVM_VERSIONS") ?:
    System.getProperties().getOrDefault("additionalTestRunsOnJVMVersions", "17,18")

additionalTestRunsOnJvmVersions.split(",").findAll({ !it.isEmpty() }).each { javaVersion ->
    def testTaskName = "testOnJava${javaVersion}"
    tasks.register(testTaskName, Test) {
        useJUnitPlatform()
        javaLauncher = javaToolchains.launcherFor {
            languageVersion = JavaLanguageVersion.of(javaVersion)
        }
    }
    tasks.named("check").configure {
        dependsOn tasks.named(testTaskName)
    }
}